-- implementa o evento acionado quando existir colisao
local colisaoChao = function (self, event)
	if ( event.phase == "began" ) then	
			personagem.sprite:setSequence("correndo")
			personagem.estadoSprite = EstadoParado:new()
			personagem:acao()
	elseif ( event.phase == "ended" ) then
			
	end
end

-- registra o evento de colisao
personagem:adicionarColisao("collision", colisaoChao)

--[[
	Codigo que implementa o evento de movimentacao e pulo do personagem.
--]]
local holding = false
local isRight = false

-- Este evento e acionado a cada frame desenhado (30 ou 60 fps)
local function enterFrameListener(event)	
	if holding then
		local movimento = personagem:mover(personagem.sprite.x, personagem.sprite.y, isRight)
		personagem.sprite:play()
		personagem.sprite.x = personagem.sprite.x + movimento
	end
end

-- Metodo que trata o evento de toque na tela
local function touchHandler( event )
    if event.phase == "began" then
        Runtime:addEventListener( "enterFrame", enterFrameListener )
        holding = true
    elseif event.phase == "ended" then
		personagem.estadoSprite = EstadoParado:new()
		personagem:acao()

		holding = false
		Runtime:removeEventListener( "enterFrame", enterFrameListener )
    end	
	isRight = (event.x > personagem.sprite.x + personagem.sprite.width)
    return true
end

local isJumping = false

-- Metodo que trata o evento de pulo do personagem principal
local function onScreenTap( event )
	if event.numTaps >= 2 then
		personagem.estadoSprite = EstadoPulando:new()
		personagem:acao()
		isJumping = true
	end	
end

-- Adiciona os eventos a tela principal (pulo e toque)
Runtime:addEventListener( "tap", onScreenTap )
Runtime:addEventListener("touch", touchHandler)